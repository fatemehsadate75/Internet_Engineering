<?php
require_once(dirname(__FILE__).'../../../config/config.inc.php'); if (!defined('_PS_VERSION_')) { exit; } if (!Module::isInstalled('ranginesmspresta')) die('Module is not installed!'); $shopids = array(); foreach (Shop::getCompleteListOfShopsID() as $id_shop){ if(Configuration::get('RANGINE_SMS_REMOTEENABLE' , null , null , (int)$id_shop) == 0) continue; $remoteKey = Configuration::get('RANGINE_SMS_REMOTEKEY' , null , null , (int)$id_shop); if (Tools::encrypt($remoteKey) == Tools::getValue('token')){ $shopids[] = $id_shop; } } if(empty($shopids)) die('Shop Not Found!'); require_once('ranginesmspresta.php'); $ranginesmspresta = new RangineSmsPresta; $text = Tools::getValue('message'); $from = str_replace('98','0',Tools::getValue('from')); $adminReportText = ''; foreach($shopids as $id_shop){ $shop = shop::getShop($id_shop); $AdminPhone = Configuration::get('RANGINE_SMS_ADMINPHONE' , null , null , $id_shop); if($from != $AdminPhone) continue; $ranginesmspresta->cronpass = true; $RemoteSMS_ENABLESHOP = Configuration::get('RANGINE_SMS_RS_ENABLESHOP' , null , null , $id_shop); $RemoteSMS_DISABLESHOP = Configuration::get('RANGINE_SMS_RS_DISABLESHOP' , null , null , $id_shop); switch($text){ case $RemoteSMS_ENABLESHOP : if(Configuration::get('PS_SHOP_ENABLE' , null , null , $id_shop) == 0){ Configuration::updateValue('PS_SHOP_ENABLE', 1, false, null, $id_shop); $adminReportText = "سایت فعال شد!\n".$shop['name']."\n"; }else{ $adminReportText = "سایت فعال بود. کاری انجام نشد!\n".$shop['name']."\n"; } if($AdminPhone != ''){ $smsResult = $ranginesmspresta->sendOne($adminReportText, $AdminPhone, '-', '-', $ranginesmspresta->l('Remote SMS')); echo $smsResult; } break; case $RemoteSMS_DISABLESHOP : if(Configuration::get('PS_SHOP_ENABLE' , null , null , (int)$context->shop->id) == 1){ Configuration::updateValue('PS_SHOP_ENABLE', 0, false, null, (int)$id_shop); $adminReportText = "سایت غیرفعال شد!\n".$shop['name']."\n"; }else{ $adminReportText = "سایت غیرفعال بود. کاری انجام نشد!\n".$shop['name']."\n"; } if($AdminPhone != ''){ $smsResult = $ranginesmspresta->sendOne($adminReportText, $AdminPhone, '-', '-', $ranginesmspresta->l('Remote SMS')); echo $smsResult; } break; } } 