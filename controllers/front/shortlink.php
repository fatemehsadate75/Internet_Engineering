<?php
 class ranginesmsprestaShortlinkModuleFrontController extends ModuleFrontController { public function init(){ parent::init(); $order_reference = Tools::getValue('order_reference'); $userInvoiceUrl = Configuration::get('RANGINE_SMS_USERINVOICE'); $guestInvoiceUrl = Configuration::get('RANGINE_SMS_GUESTINVOICE'); $order= $this->getOrderbyReference($order_reference); $customer = new Customer((int) $order['id_customer']); $vars = array( '{order_id}' => $order['id_order'], '{order_reference}' => $order_reference, '{guest_email}' => $customer->email, '{adminToken}' => Tools::getAdminTokenLite('AdminModules'), ); if($customer->is_guest) $link = str_replace(array_keys($vars), array_values($vars), $guestInvoiceUrl); else $link = str_replace(array_keys($vars), array_values($vars), $userInvoiceUrl); Tools::redirect($link); } private function getOrderbyReference($order_reference){ $sql = new DbQuery(); $sql->select('*'); $sql->from('orders', 'o'); $sql->where("o.reference = '{$order_reference}'"); $orders = Db::getInstance()->executeS($sql); return $orders[0]; } }