<?php
 class ranginesmsprestaAdminshortlinkModuleFrontController extends ModuleFrontController { public function init(){ parent::init(); $order_reference = Tools::getValue('order_reference'); $adminInvoiceUrl = Configuration::get('RANGINE_SMS_ADMININVOICE'); $order= $this->getOrderbyReference($order_reference); $customer = new Customer((int) $order['id_customer']); $vars = array( '{order_id}' => $order['id_order'], '{order_reference}' => $order_reference, '{guest_email}' => $customer->email, '{adminToken}' => Tools::getAdminTokenLite('AdminModules'), ); $link = str_replace(array_keys($vars), array_values($vars), $adminInvoiceUrl); Tools::redirectAdmin($link); } private function getOrderbyReference($order_reference){ $sql = new DbQuery(); $sql->select('*'); $sql->from('orders', 'o'); $sql->where("o.reference = '{$order_reference}'"); $orders = Db::getInstance()->executeS($sql); return $orders[0]; } }